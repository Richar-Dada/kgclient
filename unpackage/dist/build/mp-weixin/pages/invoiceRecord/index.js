(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/invoiceRecord/index"],{3649:function(e,n,t){"use strict";t.r(n);var r=t("a32a"),a=t.n(r);for(var o in r)"default"!==o&&function(e){t.d(n,e,(function(){return r[e]}))}(o);n["default"]=a.a},"36a3":function(e,n,t){"use strict";var r=t("9879"),a=t.n(r);a.a},"45bb":function(e,n,t){"use strict";t.r(n);var r=t("add5"),a=t("3649");for(var o in a)"default"!==o&&function(e){t.d(n,e,(function(){return a[e]}))}(o);t("36a3");var s,i=t("f0c5"),c=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],s);n["default"]=c.exports},9879:function(e,n,t){},a32a:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=t("81db"),a=t("2f62");function o(e){return u(e)||c(e)||i(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,n){if(e){if("string"===typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,n):void 0}}function c(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function u(e){if(Array.isArray(e))return l(e)}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function d(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?d(Object(t),!0).forEach((function(n){h(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function h(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}t("d5c7"),t("7a71");var f={data:function(){return{address:[],multiArray:[],multiIndex:[18,0],oneId:0,twoId:0,oldOwnerImageList:[],newOwnerImageList:[],vehicleLicenseImageList:[],registerImageList:[],statementImageList:[],taxImageList:[],oldCarBusinessType:"",newCarBusinessType:"",id:"",formData:{oldOwnerPhone:"",newOwnerPhone:"",carname:"",carId:"",carType:"",carNumber:"",engineNumber:"",oldCarOwner:"",newCarOwner:"",price:"",remark:"",immigrationAddress:"广东省,广州市",oldCarDocumentNumber:"",newCarDocumentNumber:"",oldCarOwnerAddress:"广东省,广州市",newCarOwnerAddress:""},businessType:[{text:"个人",value:"personal"},{text:"公司",value:"company"}],rules:{carname:{rules:[{required:!0,errorMessage:"请输入品牌型号"}]},carId:{rules:[{required:!0,errorMessage:"请输入车牌号"}]},carType:{rules:[{required:!0,errorMessage:"请输入汽车类型"}]},carNumber:{rules:[{required:!0,errorMessage:"请输入车架号"}]},oldCarOwner:{rules:[{required:!0,errorMessage:"请输入原车主姓名"}]},oldCarDocumentNumber:{rules:[{required:!0,errorMessage:"请输入证件号码"}]},oldOwnerPhone:{rules:[{required:!1,errorMessage:"请输入原车主手机号码"},{pattern:/^[1][3,4,5,7,8][0-9]{9}$/,errorMessage:"必须是11位手机号码"}]},oldCarOwnerAddress:{rules:[{required:!0,errorMessage:"请输入原车主地址"}]},newCarOwner:{rules:[{required:!0,errorMessage:"请输入新车主姓名"}]},newCarDocumentNumber:{rules:[{required:!0,errorMessage:"请输入证件号码"}]},newOwnerPhone:{rules:[{required:!1,errorMessage:"请输入新车主手机号码"},{pattern:/^[1][3,4,5,7,8][0-9]{9}$/,errorMessage:"必须是11位手机号码"}]},newCarOwnerAddress:{rules:[{required:!0,errorMessage:"请输入新车主地址"}]},immigrationAddress:{rules:[{required:!0,errorMessage:"请选择迁入地"}]},price:{rules:[{required:!0,errorMessage:"请输入发票金额"}]},remark:{rules:[]}}}},computed:m({},(0,a.mapState)(["openid"])),onReady:function(e){},onLoad:function(e){var n=e.data;if(n){var t=JSON.parse(n);console.log(t),this.id=t.id,this.formData.oldOwnerPhone=t.oldOwnerPhone,this.formData.newOwnerPhone=t.newOwnerPhone,this.formData.carname=t.carname,this.formData.carId=t.carId,this.formData.carType=t.carType,this.formData.carNumber=t.carNumber,this.formData.engineNumber=t.engineNumber,this.formData.oldCarOwner=t.oldOwner,this.formData.newCarOwner=t.newOwner,this.formData.price=t.price,this.formData.remark=t.remark,this.formData.immigrationAddress=t.immigrationAddress,this.formData.oldCarDocumentNumber=t.oldOwnerCardDocument,this.formData.newCarDocumentNumber=t.newOwnerCardDocument,this.formData.oldCarOwnerAddress=t.oldOwnerAddress,this.formData.newCarOwnerAddress=t.newOwnerAddress,this.oldCarBusinessType=t.oldOwnerBusinessType,this.newCarBusinessType=t.newOwnerBusinessType,t.oldIdCardUrl&&(this.oldOwnerImageList=[t.oldIdCardUrl]),t.newIdCardUrl&&(this.newOwnerImageList=[t.newIdCardUrl]),t.vehicleLicenseUrl&&(this.vehicleLicenseImageList=[t.vehicleLicenseUrl]),t.statementUrl&&(this.statementImageList=[t.statementUrl]),t.taxUrl&&(this.taxImageList=[t.taxUrl]),t.registerUrl&&(this.registerImageList=t.registerUrl.split(","))}this.$refs.form.setRules(this.rules),this.initData()},mounted:function(){this.oldCarBusinessType&&this.newCarBusinessType||this.$refs.dialogInput.open()},methods:{savePoster:function(){var n=this;e.getSetting({success:function(t){t.authSetting["scope.writePhotosAlbum"]?n.saveImageToPhotosAlbum():e.authorize({scope:"scope.writePhotosAlbum",success:function(){n.saveImageToPhotosAlbum()},fail:function(){e.showToast({title:"请打开保存相册权限，再点击保存相册分享",icon:"none",duration:3e3}),setTimeout((function(){e.openSetting({success:function(e){}})}),3e3)}})}})},saveImageToPhotosAlbum:function(){var n="personal"===this.newCarBusinessType?"/static/statement_pensonal.png":"/static/statement_company.png";e.saveImageToPhotosAlbum({filePath:n,success:function(n){e.hideLoading(),e.showToast({title:"保存成功，请从相册查看",icon:"none",duration:5e3})},fail:function(n){e.hideLoading()}})},showStatementExample:function(){var n="personal"===this.newCarBusinessType?"https://carbase.oss-cn-shenzhen.aliyuncs.com/statement1.jpg":"https://carbase.oss-cn-shenzhen.aliyuncs.com/statement2.jpg";e.previewImage({urls:[n]})},previewImageVehicleLicense:function(n){e.previewImage({urls:this.vehicleLicenseImageList})},previewImageveOldOwner:function(n){e.previewImage({urls:this.oldOwnerImageList})},previewImageveNewOwner:function(n){e.previewImage({urls:this.newOwnerImageList})},previewImageveRegister:function(n){e.previewImage({urls:this.registerImageList})},previewImageveStatement:function(n){e.previewImage({urls:this.statementImageList})},previewImageveTax:function(n){e.previewImage({urls:this.taxImageList})},initData:function(){var e=this;this.$request({url:"/api/vi/address",method:"GET"}).then((function(n){if(console.log("dd",n),200===n.code){e.address=n.data;var t=n.data.map((function(e){return e.name})),r=n.data[18].children.map((function(e){return e.name}));if(e.multiArray[0]=t,e.multiArray[1]=r,e.id){var a=e.formData.immigrationAddress.split(","),o=n.data.findIndex((function(e){return e.name===a[0]})),s=n.data[o].children,i=s.findIndex((function(e){return e.name===a[1]})),c=n.data[o].children.map((function(e){return e.name}));e.multiArray[0]=t,e.multiArray[1]=c,e.multiIndex=[o,i],e.oneId=a[0],e.twoId=a[1]}else{var u=n.data[18].children.map((function(e){return e.name}));e.multiArray[0]=t,e.multiArray[1]=u,e.oneId=n.data[18].name,e.twoId=n.data[18].children[0].name}}}))},bindMultiPickerColumnChange:function(e){console.log(e.detail.column,"e.detail.column表示是第几列表示是第几列"),0===e.detail.column?(this.initSelect(e.detail.value),this.multiIndex[0]=e.detail.value):1===e.detail.column&&(this.multiIndex[1]=e.detail.value,this.twoId=this.address[this.multiIndex[0]].children[this.multiIndex[1]].name),console.log("this.oneId",this.oneId),console.log("this.twoId",this.twoId),this.$refs.form.setValue("immigrationAddress",this.oneId+","+this.twoId),this.formData.immigrationAddress=this.oneId+","+this.twoId},initSelect:function(e){if(this.oneId=this.address[e].name,this.multiIndex[1]=0,this.$set(this.multiArray,1,[]),0==this.address[e].children.length)console.log("如果右边长度等于0,那么清掉右边ID"),this.twoId="";else{var n=this.address[e].children.map((function(e){return e.name}));this.$set(this.multiArray,1,n),this.twoId=this.address[e].children[0].name}},bindMultiPickerChange:function(e){},deleteImage:function(e,n){n.splice(e,1),n=o(n)},chooseImageOldOwner:function(){var n=this,t="personal"===this.oldCarBusinessType?"/api/v1/upload/idcard":"/api/v1/upload/bizlicense";e.chooseImage({count:1,sizeType:[],success:function(a){var o=a.tempFilePaths[0];e.showLoading(),e.uploadFile({url:r.baseUrl+t,filePath:o,name:"image",success:function(t){console.log(t),e.hideLoading();var r=JSON.parse(t.data);200===r.code?(e.showToast({title:"上传成功",icon:"success",duration:1e3}),n.oldOwnerImageList.push(r.data.imageUrl),n.formData.oldCarOwner=r.data.Name,"personal"===n.oldCarBusinessType?n.formData.oldCarDocumentNumber=r.data.IdNum:n.formData.oldCarDocumentNumber=r.data.RegNum,n.formData.oldCarOwnerAddress=r.data.Address):e.showToast({title:"图片有误，识别失败",icon:"none"})},fail:function(n){console.log("uploadImage fail",n),e.showModal({content:n.errMsg,showCancel:!1})}})},fail:function(e){console.log("chooseImage fail",e)}})},chooseImageNewOwner:function(){var n=this,t="personal"===this.newCarBusinessType?"/api/v1/upload/idcard":"/api/v1/upload/bizlicense";e.chooseImage({count:1,sizeType:[],success:function(a){var o=a.tempFilePaths[0];e.showLoading(),e.uploadFile({url:r.baseUrl+t,filePath:o,name:"image",success:function(t){console.log(t),e.hideLoading();var r=JSON.parse(t.data);200===r.code?(e.showToast({title:"上传成功",icon:"success",duration:1e3}),n.newOwnerImageList.push(r.data.imageUrl),n.formData.newCarOwner=r.data.Name,"personal"===n.newCarBusinessType?n.formData.newCarDocumentNumber=r.data.IdNum:n.formData.newCarDocumentNumber=r.data.RegNum,n.formData.newCarOwnerAddress=r.data.Address):e.showToast({title:"图片有误，识别失败",icon:"none"})},fail:function(n){console.log("uploadImage fail",n),e.showModal({content:n.errMsg,showCancel:!1})}})},fail:function(e){console.log("chooseImage fail",e)}})},chooseImageVehicleLicense:function(){var n=this;e.chooseImage({count:1,sizeType:[],success:function(t){var a=t.tempFilePaths[0];e.showLoading(),e.uploadFile({url:r.baseUrl+"/api/v1/upload/vehiclelicense",filePath:a,name:"image",success:function(t){console.log(t),e.hideLoading();var r=JSON.parse(t.data);if(200===r.code){e.showToast({title:"上传成功",icon:"success",duration:1e3}),n.vehicleLicenseImageList.push(r.data.imageUrl),console.log(r);var a=r.data.FrontInfo;a&&(n.formData.carId=a.PlateNo,n.formData.carNumber=a.Vin,n.formData.carname=a.Model,n.formData.carType=a.VehicleType)}else e.showToast({title:"图片有误，识别失败",icon:"none"})},fail:function(n){console.log("uploadImage fail",n),e.showModal({content:n.errMsg,showCancel:!1})}})},fail:function(e){console.log("chooseImage fail",e)}})},chooseImageRegister:function(){var n=this;e.chooseImage({count:1,sizeType:[],success:function(t){var a=t.tempFilePaths[0];e.showLoading(),e.uploadFile({url:r.baseUrl+"/api/v1/upload",filePath:a,name:"image",success:function(t){console.log(t),e.hideLoading();var r=JSON.parse(t.data);200===r.code?(e.showToast({title:"上传成功",icon:"success",duration:1e3}),console.log(r),n.registerImageList.push(r.data[0])):e.showToast({title:"图片上传失败",icon:"none"})},fail:function(n){e.showModal({content:n.errMsg,showCancel:!1})}})},fail:function(e){console.log("chooseImage fail",e)}})},chooseImageStatement:function(){var n=this;e.chooseImage({count:1,sizeType:[],success:function(t){var a=t.tempFilePaths[0];e.showLoading(),e.uploadFile({url:r.baseUrl+"/api/v1/upload",filePath:a,name:"image",success:function(t){e.hideLoading(),console.log(t);var r=JSON.parse(t.data);200===r.code?(e.showToast({title:"上传成功",icon:"success",duration:1e3}),console.log(r),n.statementImageList.push(r.data[0])):e.showToast({title:"图片上传失败",icon:"none"})},fail:function(n){e.showModal({content:n.errMsg,showCancel:!1})}})},fail:function(e){console.log("chooseImage fail",e)}})},chooseImageTax:function(){var n=this;e.chooseImage({count:1,sizeType:[],success:function(t){var a=t.tempFilePaths[0];e.showLoading(),e.uploadFile({url:r.baseUrl+"/api/v1/upload",filePath:a,name:"image",success:function(t){console.log(t),e.hideLoading();var r=JSON.parse(t.data);200===r.code?(e.showToast({title:"上传成功",icon:"success",duration:1e3}),console.log(r),n.taxImageList.push(r.data[0])):e.showToast({title:"图片上传失败",icon:"none"})},fail:function(n){e.showModal({content:n.errMsg,showCancel:!1})}})},fail:function(e){console.log("chooseImage fail",e)}})},businessConfirm:function(){this.oldCarBusinessType&&this.newCarBusinessType?this.$refs.dialogInput.close():e.showToast({title:"请选择所有权",icon:"none"})},submitForm:function(n){var t=this;this.$refs[n].submit().then((function(n){t.registerImageList.length?t.statementImageList.length?t.id?t.update():t.create():e.showToast({title:"请上传声明照",icon:"none"}):e.showToast({title:"请上传登记证图片",icon:"none"})}))},create:function(){e.showLoading(),this.$request({url:"/api/v1/admin/invoice/create/wx",method:"POST",data:{immigrationAddress:this.formData.immigrationAddress,newOwner:this.formData.newCarOwner,newOwnerCardDocument:this.formData.newCarDocumentNumber,newOwnerPhone:+this.formData.newOwnerPhone,oldOwner:this.formData.oldCarOwner,oldOwnerCardDocument:this.formData.oldCarDocumentNumber,oldOwnerPhone:+this.formData.oldOwnerPhone,carType:this.formData.carType,carId:this.formData.carId,carNumber:this.formData.carNumber,carname:this.formData.carname,price:this.formData.price,remark:this.formData.remark,oldIdCardUrl:this.oldOwnerImageList[0],newIdCardUrl:this.newOwnerImageList[0],vehicleLicenseUrl:this.vehicleLicenseImageList[0],registerUrl:this.registerImageList.join(","),statementUrl:this.statementImageList[0],taxUrl:this.taxImageList[0],createBy:this.openid,oldOwnerBusinessType:this.oldCarBusinessType,newOwnerBusinessType:this.newCarBusinessType,oldOwnerAddress:this.formData.oldCarOwnerAddress,newOwnerAddress:this.formData.newCarOwnerAddress}}).then((function(n){e.hideLoading(),200===n.code?(e.showToast({title:"登记成功",icon:"success"}),e.$emit("inoviceCreate"),setTimeout((function(){e.redirectTo({url:"../payment/index?pid="+n.data.pid})}),1e3)):e.showToast({title:n.msg,icon:"none"})}))},update:function(){e.showLoading(),this.$request({url:"/api/v1/admin/invoice/update/wx/"+this.id,method:"POST",data:{immigrationAddress:this.formData.immigrationAddress,newOwner:this.formData.newCarOwner,newOwnerCardDocument:this.formData.newCarDocumentNumber,newOwnerPhone:+this.formData.newOwnerPhone,oldOwner:this.formData.oldCarOwner,oldOwnerCardDocument:this.formData.oldCarDocumentNumber,oldOwnerPhone:+this.formData.oldOwnerPhone,carType:this.formData.carType,carId:this.formData.carId,carNumber:this.formData.carNumber,carname:this.formData.carname,price:this.formData.price,remark:this.formData.remark,oldIdCardUrl:this.oldOwnerImageList[0],newIdCardUrl:this.newOwnerImageList[0],vehicleLicenseUrl:this.vehicleLicenseImageList[0],registerUrl:this.registerImageList.join(","),statementUrl:this.statementImageList[0],taxUrl:this.taxImageList[0],createBy:this.openid,oldOwnerBusinessType:this.oldCarBusinessType,newOwnerBusinessType:this.newCarBusinessType,oldOwnerAddress:this.formData.oldCarOwnerAddress,newOwnerAddress:this.formData.newCarOwnerAddress}}).then((function(n){e.hideLoading(),200===n.code?(e.showToast({title:"修改成功",icon:"success"}),e.$emit("inoviceUpdate"),setTimeout((function(){e.navigateBack()}),1e3)):e.showToast({title:n.msg,icon:"none"})}))}}};n.default=f}).call(this,t("543d")["default"])},add5:function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return o})),t.d(n,"a",(function(){return r}));var r={uniNoticeBar:function(){return t.e("components/uni-notice-bar/uni-notice-bar").then(t.bind(null,"1163"))},uniPopup:function(){return Promise.all([t.e("common/vendor"),t.e("components/uni-popup/uni-popup")]).then(t.bind(null,"9edd"))},uniForms:function(){return Promise.all([t.e("common/vendor"),t.e("components/uni-forms/uni-forms")]).then(t.bind(null,"12d1"))},uniFormsItem:function(){return Promise.all([t.e("common/vendor"),t.e("components/uni-forms-item/uni-forms-item")]).then(t.bind(null,"bd5c"))},uniDataCheckbox:function(){return Promise.all([t.e("common/vendor"),t.e("components/uni-data-checkbox/uni-data-checkbox")]).then(t.bind(null,"d3b0"))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("components/uni-icons/uni-icons")]).then(t.bind(null,"c5de"))},uniGroup:function(){return t.e("components/uni-group/uni-group").then(t.bind(null,"0c0b"))},uniEasyinput:function(){return Promise.all([t.e("common/vendor"),t.e("components/uni-easyinput/uni-easyinput")]).then(t.bind(null,"455b"))}},a=function(){var e=this,n=e.$createElement;e._self._c},o=[]},e2e7:function(e,n,t){"use strict";(function(e){t("9634");r(t("66fd"));var n=r(t("45bb"));function r(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])}},[["e2e7","common/runtime","common/vendor"]]]);